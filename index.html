<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>easyJet Org – AntV G6 (TreeGraph, large toggle)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { height:100%; margin:0; background:#f6f7f9; }
    #mount { height:100vh; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@antv/g6@5/dist/g6.min.js"></script>
</head>
<body>
  <div id="mount"></div>

  <script>
    // ---------- Data ----------
    const data = {
      id: 'Kenton Jarvis',
      title: '',
      children: [
        { id: 'Sophie Dekkers', title: 'Chief Commercial Officer' },
        { id: 'Robert Birge', title: 'Chief Customer and Marketing Officer' },
        { id: 'Donna Collins', title: 'Executive Assistant to CEO' },
        {
          id: 'David Morgan', title: 'Chief Operations Officer', children: [
            { id: 'Daniele Grassini', title: 'Director of Training and Standards' },
            { id: 'Michael Brown', title: 'Director of Cabin Services' },
            { id: 'Neil Slaven', title: 'Director of Operations Strategy and Planning' },
            { id: 'Karen Honour', title: 'Executive Assistant' },
            { id: 'Simon Cox', title: 'Director of Ground Operations' },
            { id: 'Chris Hartman', title: 'Operations Consultant' },
            { id: 'Gill Baudot', title: 'Director of Network Control' },
            { id: 'Brendan McConnellogue', title: 'Director of Engineering & Maintenance' },
            {
              id: 'Bart Prudon', title: 'Director of Flight Operations', children: [
                { id: 'Jamie Fraser', title: 'Head of Operations Transformation' },
                { id: 'Alexander Gerritsen', title: 'Chief Pilot' },
                { id: 'Paul Ingram', title: 'Head of Flight Crew Operations' },
                { id: 'Emily Tollafield', title: 'Head of Business Delivery' },
                { id: 'Joakim Westberg', title: 'Safety Manager AOC, ATO & CAMO' }
              ]
            },
            { id: 'Jim Pegram', title: 'Director Safety, Security & Compliance' },
            { id: 'Hugh McConnellogue', title: 'Director of Gatwick' },
            { id: 'Jean-Marc Thevenaz', title: 'Managing Director Switzerland' }
          ]
        },
        { id: 'Opal Perry', title: 'Chief Data and Technology Officer' },
        { id: 'Thomas Haagensen', title: 'Group Markets Director' },
        { id: 'Rebecca Mills', title: 'Group General Counsel and Company Secretary' },
        { id: 'Elly Tomlins', title: 'Chief People Officer' },
        { id: 'Garry Wilson', title: 'Chief Executive Officer – easyJet Holidays' },
        { id: 'Jan De Raeymaeker', title: 'Chief Financial Officer' }
      ]
    };

    // ---------- Custom "card" node with LARGE toggle ----------
    G6.registerNode('card-node', {
      draw(cfg, group) {
        const width = 280, height = 78, radius = 12;
        const keyShape = group.addShape('rect', {
          attrs: {
            x: -width/2, y: -height/2, width, height, radius,
            fill: '#fff', stroke: '#e6e9ef', lineWidth: 1.2,
            shadowColor: 'rgba(17,24,39,0.08)', shadowBlur: 8, shadowOffsetY: 2
          },
          name: 'card-bg',
        });

        // Name
        group.addShape('text', {
          attrs: { x: -width/2 + 16, y: -8, text: cfg.id, fontSize: 15, fontWeight: 700, fill: '#111827' },
          name: 'title',
        });

        // Title / role
        group.addShape('text', {
          attrs: { x: -width/2 + 16, y: 16, text: cfg.title || '', fontSize: 12.5, fill: '#6b7280' },
          name: 'subtitle',
        });

        // Big, high-contrast collapse/expand pill (only if node has children)
        if (cfg.children && cfg.children.length) {
          const x = width/2 - 20;
          const y = 0;

          // Hitbox (larger transparent area for easier clicking)
          group.addShape('circle', {
            attrs: { x, y, r: 20, fill: 'transparent', cursor: 'pointer' },
            name: 'collapse-hit',
            draggable: true
          });

          // Visible button
          group.addShape('circle', {
            attrs: {
              x, y, r: 16,
              fill: '#ff6600',   // easyJet orange
              stroke: '#fff',
              lineWidth: 2,
              cursor: 'pointer',
              shadowColor: 'rgba(0,0,0,0.18)',
              shadowBlur: 6
            },
            name: 'collapse-btn-bg',
            draggable: true
          });

          // Icon (+ / −), bold and centered
          group.addShape('text', {
            attrs: {
              x, y: y + 1,
              text: cfg.collapsed ? '+' : '−',
              fontSize: 22,
              fontWeight: 800,
              textAlign: 'center',
              textBaseline: 'middle',
              fill: '#fff',
              cursor: 'pointer'
            },
            name: 'collapse-btn',
            draggable: true
          });
        }

        return keyShape;
      },
      getAnchorPoints() { return [[0.5, 1], [0.5, 0]]; }
    }, 'single-node');

    // ---------- TreeGraph ----------
    const container = document.getElementById('mount');
    const graph = new G6.TreeGraph({
      container: 'mount',
      width: container.clientWidth,
      height: container.clientHeight,
      // Pan & zoom, plus built-in collapse/expand
      modes: {
        default: [
          'drag-canvas',
          'zoom-canvas',
          {
            type: 'collapse-expand',
            onChange: (item, collapsed) => {
              const model = item.getModel();
              model.collapsed = collapsed;
              return true;
            }
          }
        ]
      },
      layout: {
        type: 'compactBox',
        direction: 'TB', // top-to-bottom
        getId: d => d.id,
        getHeight: () => 84,
        getWidth: () => 280,
        getVGap: () => 26,
        getHGap: () => 36
      },
      defaultNode: { type: 'card-node' },
      defaultEdge: { type: 'polyline', style: { radius: 8, offset: 24, stroke: '#cbd5e1' } }
    });

    // Explicitly toggle when clicking the big orange button
    graph.on('node:click', (ev) => {
      const targetName = ev.target && ev.target.get('name');
      if (targetName === 'collapse-btn' || targetName === 'collapse-btn-bg' || targetName === 'collapse-hit') {
        const item = ev.item;
        const collapsed = !item.getModel().collapsed;
        graph.updateItem(item, { collapsed });
        graph.layout();
        graph.fitCenter();
      }
    });

    // Optional: log clicks on nodes
    graph.on('node:click', (ev) => {
      if (['collapse-btn','collapse-btn-bg','collapse-hit'].includes(ev.target?.get('name'))) return;
      const m = ev.item.getModel();
      console.log('Clicked:', m.id, '-', m.title || '');
    });

    // Render
    graph.data(data);
    graph.render();
    graph.fitCenter();

    // Resize
    window.addEventListener('resize', () => {
      graph.changeSize(container.clientWidth, container.clientHeight);
    });
  </script>
</body>
</html>
